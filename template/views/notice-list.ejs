<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/css/toastify.css" />

    <link rel="stylesheet" href="/css/common.css " />
    <link rel="stylesheet" href="/css/user/navbar.css" />
    <link rel="stylesheet" href="/css/user/notice-list.css" />
    <script type="module" src="https://unpkg.com/phosphor-icons"></script>
    <script src="/js/toastify.js"></script>
    <script src="/js/moment.js"></script>
  </head>
  <body>
    <%- include("../parttial/navbar.ejs") %>

    <div class="noitce-container">
      <img
        src="https://images.unsplash.com/photo-1423592707957-3b212afa6733?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1932&q=80"
        width="100%"
      />
      <div class="left_div">
        <div class="head">
          <p>New Notice</p>
        </div>

        <div class="child">
          <p>
            Lorem ipsum, dolor sit amet consectetur adipisicing elit.
            Consequuntur doloribus quod tempora illum nihil ab iure dignissimos
            itaque debitis inventore.
          </p>
        </div>

        <br />

        <button>
          <a href="#"> Check out </a>
          <i
            style="margin-top: 10px; color: #f2f2f2; margin-left: 5px"
            class="fas fa-arrow-right"
          ></i>
        </button>
      </div>
    </div>

    <div class="notice-list">
      <div class="notice-list-view">
        <div class="search-options">
          <select>
            <option selected>Title</option>
            <option>Date</option>
          </select>

          <input
            id="search_text"
            type="text"
            placeholder="search by title or date"
          />
          <i
            onclick="Search()"
            class="ph-magnifying-glass-bold search-icon"
          ></i>
          <i onclick="Clear()" class="ph-arrow-clockwise-bold refresh-icon"></i>
        </div>

        <p
          style="text-align: center; margin: 5px 0 10px 0; display: none"
          class="error-text-for-search"
        ></p>

        <div class="line"></div>

        <div></div>

        <% if(Object.keys(data).length != 0){ %>

        <table id="maintable" class="table">
          <thead>
            <tr>
              <th scope="col">No</th>
              <th scope="col">Title</th>
              <th scope="col">Date</th>
              <th scope="col">View</th>
            </tr>
          </thead>
          <% for (let index = startingIndex; index < endingIndex; index++) { %>
          <tbody>
            <tr>
              <th scope="row"><%= index+1 %></th>
              <td><%= data[index].title %></td>
              <td><%= data[index].date %></td>
              <td>
                <a
                  style="text-decoration: none"
                  href="/notice/all-notice-list/<%= data[index]._id %>"
                >
                  view</a
                >
              </td>
            </tr>
          </tbody>
          <% } %>
        </table>

        <div class="end-line"></div>

        <div class="pagination">
          <span id="prev-btn" class="icon" href="#">&laquo;</span>

          <% for(index = 1; index <= totalPage; index++){ %> <% if(index ===
          default_number) { %>
          <span
            onclick="GetNotices('<%= index %>')"
            href="#"
            class="active page"
            id="<%= index %>"
            ><%= index %></span
          >
          <% } else { %>

          <span
            class="page"
            onclick="GetNotices('<%= index %>')"
            href="#"
            id="<%= index %>"
            ><%= index %></span
          >
          <% } %> <% } %>

          <span id="next-btn" class="icon" href="#">&raquo;</span>
        </div>
      </div>

      <% } else { %> <% } %>

      <div class="add-section"></div>
    </div>

    <script type="text/javascript" defer>
      const maintable = document.getElementById("maintable");
      const tablebody = maintable.getElementsByTagName("tbody");

      const FailureToast = Toastify({
        text: "Sorry! Try Again Later",
        duration: 2000,
      });

      async function GetNotices(pagenumber) {
        const response = await fetch(`/notice/all-notice-list/${pagenumber}`, {
          method: "POST",
        });

        const result = await response.json();

        if (result.error) {
          FailureToast.showToast();
          // incase any error occured
        } else {
          let { startingIndex, endingIndex, totalPage, data, default_number } =
            result.information;

          const noticeInformation = [];

          const all_page = document.querySelectorAll(".page");

          for (let index = 0; index < all_page.length; index++) {
            all_page[index].classList.remove("active");
          }

          for (let index = startingIndex; index < endingIndex; index++) {
            const { date, title, _id } = data[index];
            noticeInformation.push({ date, title, _id });
          }

          let counter = 0; // for table
          let counter2 = 0; // for information object

          for (let index = startingIndex; index < endingIndex; index++) {
            tablebody[counter]
              .getElementsByTagName("tr")[0]
              .getElementsByTagName("th")[0].innerHTML = ++startingIndex;

            tablebody[counter]
              .getElementsByTagName("tr")[0]
              .getElementsByTagName("td")[0].innerHTML =
              noticeInformation[counter2].title;

            tablebody[counter]
              .getElementsByTagName("tr")[0]
              .getElementsByTagName("td")[1].innerHTML =
              noticeInformation[counter2].date;

            const url =
              "/notice/all-notice-list/" + noticeInformation[counter2]._id;

            tablebody[counter]
              .getElementsByTagName("tr")[0]
              .getElementsByTagName("td")[2].children[0].href = url;

            counter++;
            counter2++;
          }

          all_page[default_number - 1].classList.add("active");
        }
      }

      document
        .getElementById("prev-btn")
        .addEventListener("click", function (e) {
          document.querySelector(".pagination").scrollLeft -= 300;
          e.preventDefault();
        });

      document
        .getElementById("next-btn")
        .addEventListener("click", function (e) {
          document.querySelector(".pagination").scrollLeft += 300;
          e.preventDefault();
        });

      // search related functionality

      function Clear() {
        document.getElementById("search_text").value = "";

        console.log(maintable.children[1].children[0].remove());
      }

      async function Search() {
        const search_text = document.getElementById("search_text").value;

        if (search_text) {
          // create a request
          const response = await fetch(
            `/notice/all-notice-list/search/${search_text}`,
            {
              method: "POST",
            }
          );

          if (response.status === 200) {
            console.log("All Fine!");

            Clear();
          } else {
            FailureToast.showToast();
          }
        } else {
          alert("please write some text to search");
        }
      }
    </script>
  </body>
</html>
